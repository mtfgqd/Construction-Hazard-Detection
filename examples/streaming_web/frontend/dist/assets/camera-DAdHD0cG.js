import"./styles-DN4adpF2.js";let e;document.addEventListener("DOMContentLoaded",()=>{const c=new URLSearchParams(window.location.search),s=c.get("label"),o=c.get("key");if(!s||!o){console.error("Label or key parameter is missing"),window.location.href="index.html";return}const r=document.getElementById("camera-title"),l=document.getElementById("stream-image"),n=document.getElementById("loading-indicator"),d=document.getElementById("stream-meta"),m=document.getElementById("warnings-ul");r.textContent=`${s} - ${o}`,p(s,o,l,n,d,m),window.addEventListener("beforeunload",()=>{e&&e.close()})});function p(c,s,o,r,l,n){const d=window.location.protocol==="https:"?"wss://":"ws://";e=new WebSocket(`${d}${window.location.host}/api/ws/stream/${encodeURIComponent(c)}/${encodeURIComponent(s)}`);const m=["No warnings","無警告","无警告","Pas d'avertissement","Không có cảnh báo","Tidak ada peringatan","ไม่มีคำเตือน"];e.onopen=()=>{console.log("WebSocket connected!"),setInterval(()=>{e.readyState===WebSocket.OPEN&&e.send(JSON.stringify({type:"ping"}))},3e4)},e.onmessage=g=>{const a=JSON.parse(g.data);if(a.error)console.error(a.error),window.location.href="index.html";else{if(a.image){r.style.display="none",o.style.display="block",o.src=`data:image/png;base64,${a.image}`;const t=new Date().toLocaleString();l.textContent=`Last updated: ${t}`}const i=a.warnings?a.warnings.split(`
`):["No warnings"];if(n.innerHTML="",i.length===1&&m.includes(i[0])){n.className="no-warnings";const t=document.createElement("p");t.textContent=i[0],t.classList.add("warning-item","no-warning"),n.appendChild(t)}else n.className="warnings",i.forEach(t=>{const w=document.createElement("p");w.textContent=t,w.classList.add("warning-item"),n.appendChild(w)})}},e.onerror=g=>{console.error("WebSocket error:",g),window.location.href="index.html"},e.onclose=()=>{console.log("WebSocket closed")}}
